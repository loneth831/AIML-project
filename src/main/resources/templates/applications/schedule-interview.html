<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="'Schedule Interview - ' + ${candidate.fullName}">Schedule Interview</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
    <style>
        .candidate-summary {
            background: linear-gradient(135deg, #6c5ce7, #a29bfe);
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .form-section {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
<div th:replace="fragments/header :: header"></div>

<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 mx-auto">
            <!-- Header -->
            <div class="mb-4">
                <a th:href="@{/applications/{id}(id=${application.id})}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> Back to Application
                </a>
                <h2 class="mt-3"><i class="bi bi-calendar-plus"></i> Schedule Interview</h2>
            </div>

            <!-- Candidate Summary -->
            <div class="candidate-summary">
                <div class="row">
                    <div class="col-md-8">
                        <h4 th:text="${candidate.fullName}">John Doe</h4>
                        <p class="mb-1" th:text="${candidate.email}">john@example.com</p>
                        <p class="mb-0">
                            <span class="badge bg-light text-dark" th:text="${job.title}">Software Engineer</span>
                            <span class="badge bg-light text-dark ms-2" th:text="${job.department}">Engineering</span>
                        </p>
                    </div>
                    <div class="col-md-4 text-end">
                        <div class="display-6" th:text="${#numbers.formatDecimal(application.matchScore, 1, 1)} + '%'">85%</div>
                        <p class="mb-0">AI Match Score</p>
                    </div>
                </div>
            </div>

            <!-- Interview Form -->
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-calendar"></i> Interview Details</h5>
                </div>
                <div class="card-body">
                    <form th:action="@{/applications/{id}/schedule-interview(id=${application.id})}"
                          method="post" id="interviewForm">

                        <!-- Date and Time -->
                        <div class="form-section">
                            <h6><i class="bi bi-clock"></i> Date & Time</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <label class="form-label">Interview Date *</label>
                                    <input type="date" class="form-control" id="interviewDate"
                                           name="interviewDate" required
                                           th:min="${#temporals.format(#temporals.createNow(), 'yyyy-MM-dd')}">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Interview Time *</label>
                                    <input type="time" class="form-control" id="interviewTime"
                                           name="interviewTime" required>
                                </div>
                            </div>
                        </div>

                        <!-- Interview Type -->
                        <div class="form-section">
                            <h6><i class="bi bi-person-video"></i> Interview Type</h6>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="btn-group w-100" role="group">
                                        <input type="radio" class="btn-check" name="interviewType"
                                               id="typeOnline" value="ONLINE" checked>
                                        <label class="btn btn-outline-primary" for="typeOnline">
                                            <i class="bi bi-camera-video"></i> Online
                                        </label>

                                        <input type="radio" class="btn-check" name="interviewType"
                                               id="typePhone" value="PHONE">
                                        <label class="btn btn-outline-primary" for="typePhone">
                                            <i class="bi bi-telephone"></i> Phone
                                        </label>

                                        <input type="radio" class="btn-check" name="interviewType"
                                               id="typeInPerson" value="IN_PERSON">
                                        <label class="btn btn-outline-primary" for="typeInPerson">
                                            <i class="bi bi-building"></i> In Person
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Location/Meeting Link (dynamic based on type) -->
                        <div class="form-section" id="onlineSection">
                            <h6><i class="bi bi-link"></i> Meeting Details</h6>
                            <div class="mb-3">
                                <label class="form-label">Meeting Link *</label>
                                <input type="url" class="form-control" name="interviewLink"
                                       placeholder="https://meet.google.com/..." value="https://meet.google.com/">
                            </div>
                        </div>

                        <div class="form-section" id="inPersonSection" style="display: none;">
                            <h6><i class="bi bi-geo-alt"></i> Location Details</h6>
                            <div class="mb-3">
                                <label class="form-label">Location/Address *</label>
                                <input type="text" class="form-control" name="interviewLocation"
                                       placeholder="Office address, room number, etc.">
                            </div>
                        </div>

                        <div class="form-section" id="phoneSection" style="display: none;">
                            <h6><i class="bi bi-telephone"></i> Phone Details</h6>
                            <div class="mb-3">
                                <label class="form-label">Phone Number *</label>
                                <input type="tel" class="form-control" name="phoneNumber"
                                       placeholder="Enter phone number for interview">
                            </div>
                        </div>

                        <!-- Interviewer Information -->
                        <div class="form-section">
                            <h6><i class="bi bi-person"></i> Interviewer Information</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <label class="form-label">Interviewer Name</label>
                                    <input type="text" class="form-control" name="interviewerName"
                                           placeholder="e.g., John Smith">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Interviewer Email</label>
                                    <input type="email" class="form-control" name="interviewerEmail"
                                           placeholder="interviewer@company.com">
                                </div>
                            </div>
                        </div>

                        <!-- Duration -->
                        <div class="form-section">
                            <h6><i class="bi bi-hourglass"></i> Duration</h6>
                            <select class="form-select" name="interviewDuration">
                                <option value="30 minutes">30 minutes</option>
                                <option value="45 minutes">45 minutes</option>
                                <option value="60 minutes" selected>60 minutes</option>
                                <option value="90 minutes">90 minutes</option>
                                <option value="120 minutes">120 minutes</option>
                            </select>
                        </div>

                        <!-- Instructions -->
                        <div class="form-section">
                            <h6><i class="bi bi-list-check"></i> Instructions for Candidate</h6>
                            <textarea class="form-control" name="instructions" rows="4"
                                      placeholder="Enter any preparation instructions, documents to bring, etc."></textarea>
                        </div>

                        <!-- Additional Notes -->
                        <div class="form-section">
                            <h6><i class="bi bi-sticky"></i> Additional Notes</h6>
                            <textarea class="form-control" name="additionalNotes" rows="2"
                                      placeholder="Internal notes (not shared with candidate)"></textarea>
                        </div>

                        <!-- Notification Options -->
                        <div class="form-section">
                            <h6><i class="bi bi-bell"></i> Notifications</h6>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="sendEmail" id="sendEmail" checked>
                                <label class="form-check-label" for="sendEmail">
                                    Send email notification to candidate
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="sendCalendar" id="sendCalendar" checked>
                                <label class="form-check-label" for="sendCalendar">
                                    Send calendar invitation
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="notifyInterviewer" id="notifyInterviewer" checked>
                                <label class="form-check-label" for="notifyInterviewer">
                                    Notify interviewer
                                </label>
                            </div>
                        </div>

                        <!-- Submit Buttons -->
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-success btn-lg">
                                <i class="bi bi-calendar-check"></i> Schedule Interview
                            </button>
                            <a th:href="@{/applications/{id}(id=${application.id})}" class="btn btn-outline-secondary">
                                Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Handle interview type toggle
    document.querySelectorAll('input[name="interviewType"]').forEach(radio => {
        radio.addEventListener('change', function() {
            // Hide all sections
            document.getElementById('onlineSection').style.display = 'none';
            document.getElementById('inPersonSection').style.display = 'none';
            document.getElementById('phoneSection').style.display = 'none';

            // Show selected section
            if (this.value === 'ONLINE') {
                document.getElementById('onlineSection').style.display = 'block';
            } else if (this.value === 'IN_PERSON') {
                document.getElementById('inPersonSection').style.display = 'block';
            } else if (this.value === 'PHONE') {
                document.getElementById('phoneSection').style.display = 'block';
            }
        });
    });

    // Set minimum date to today
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('interviewDate').min = today;

    // Form validation
    document.getElementById('interviewForm').addEventListener('submit', function(e) {
        const date = document.getElementById('interviewDate').value;
        const time = document.getElementById('interviewTime').value;

        if (!date || !time) {
            e.preventDefault();
            alert('Please select both date and time');
            return;
        }

        // Combine date and time
        const dateTimeInput = document.createElement('input');
        dateTimeInput.type = 'hidden';
        dateTimeInput.name = 'interviewDateTime';
        dateTimeInput.value = date + 'T' + time + ':00';
        this.appendChild(dateTimeInput);
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>